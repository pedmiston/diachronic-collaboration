---
title: "Kaggle competition leaderboards"
author: "Pierce Edmiston"
output:
  html_document:
    theme: flatly
    toc: true
    toc_float: true
---

```{r config, echo = FALSE}
library(knitr)
opts_chunk$set(
  echo = FALSE,
  message = FALSE,
  dev = c("svg", "png"),
  fig.path = "figs/",
  fig.height = 4,
  fig.width = 4
)
```

```{r setup}
library(dplyr)
library(magrittr)
library(ggplot2)
library(gridExtra)
library(scales)

library(evoteams)
data("leaderboards")

leaderboards %<>%
  group_by(slug) %>%
  arrange(desc(score)) %>%
  mutate(place = 1:n()) %>%
  ungroup

entries_per_place <- leaderboards %>%
  group_by(place) %>%
  summarize(
    entries = mean(entries),
    team_size = mean(team_size)
  )

top_100 <- entries_per_place %>%
  filter(place <= 100) %>%
  mutate(first_place = place == 1)

# theme
base_theme <- theme_minimal() +
  theme(
    legend.position = "none",
    axis.ticks = element_blank(),
    panel.grid.minor.x = element_blank()
  )

colors <- RColorBrewer::brewer.pal(3, "Set2")
names(colors) <- c("green", "orange", "blue")

default_alpha <- 0.6
```

# Top 100

```{r top-100, fig.width = 8}
scale_x_place <- scale_x_continuous(breaks = c(1, seq(10, 100, by = 10)))
scale_x_team_size <- scale_x_continuous("team size", breaks = 1:4)
scale_y_team_size <- scale_y_continuous("team size", breaks = 1:4)
scale_y_submissions <- scale_y_continuous("submissions", breaks = c(1, seq(5, 100, by = 5)))
scale_color_first_place <- scale_color_manual(
  values = c(colors[["green"]], colors[["orange"]])
)

entries <- ggplot(top_100, aes(place, entries)) +
  geom_point(aes(color = first_place), alpha = default_alpha) +
  scale_x_place +
  scale_y_submissions +
  scale_color_first_place +
  coord_cartesian(xlim = c(1, 100), ylim = c(1, 39)) +
  base_theme +
  ggtitle("Number of submissions")

team_size <- ggplot(top_100, aes(place, team_size)) +
  geom_point(aes(color = first_place), alpha = default_alpha) +
  scale_x_place +
  scale_y_team_size +
  scale_color_first_place +
  coord_cartesian(xlim = c(1, 100), ylim = c(1:3)) +
  base_theme +
  ggtitle("Size of team")

grid.arrange(entries, team_size, ncol = 2)
```

```{r correlation}
ggplot(top_100, aes(team_size, entries)) +
  geom_point(aes(color = first_place), alpha = default_alpha) +
  scale_x_continuous("team size", breaks = 1:4) +
  scale_y_continuous("submissions", breaks = c(1, seq(5, 100, by = 5))) +
  scale_color_first_place +
  coord_cartesian(xlim = c(1, 3), ylim = c(1, 39)) +
  base_theme
```

# Team sizes

```{r team-sizes}
place_by_team_size <- leaderboards %>%
  filter(place <= 100) %>%
  group_by(team_size) %>%
  summarize(
    place = mean(place),
    n = n()
  ) %>%
  mutate(
    pct = n/sum(n)
  )

ggplot(place_by_team_size, aes(team_size, place)) +
  geom_point(aes(size = pct), alpha = default_alpha) +
  scale_x_continuous("team size", breaks = c(1, seq(10, 40, by = 10))) +
  scale_y_reverse("place", breaks = c(1, seq(5, 100, by = 5))) +
  scale_size_continuous("Teams", labels = percent) +
  base_theme +
  theme(
    legend.position = "right"
  )
```